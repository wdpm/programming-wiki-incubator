# Note
《代码本色：用编程模拟自然系统》笔记

## introduction

- random number - uniform distribution 
```
int[] stuff = new int[5]
1 is stored in the array twice, making it more likely to be picked.
stuff[0] = 1;
stuff[1] = 1;
stuff[2] = 2;
stuff[3] = 3;
stuff[4] = 3;
Picking a random element from an array
int index = int(random(stuff.length))
```

```
float prob = 0.10;
//A random floating point value between 0 and 1
float r = random(1);
 
//If our random number is less than 0.1, try again!
if (r < prob) {
   // try again!
}
```
- random number - normal distribution(bell curve)
> the curve is generated by a mathematical function that defines the probability of any given value occurring 
> as a function of the mean (often written as μ, the Greek letter mu) and standard deviation (σ, the Greek letter sigma)

Gaussian distribution: mean =0, standard deviation =1

variants:
```js
// Get a gaussian random number w/ mean of 0 and standard deviation of 1.0
let xloc = randomGaussian();

const sd = 60;                // Define a standard deviation
const mean = width/2;         // Define a mean value (middle of the screen along the x-axis)
xloc = ( xloc * sd ) + mean;  // Scale the gaussian random number by standard deviation and mean
```

- random number - montecarlo
```
float montecarlo() {
  // We do this “forever” until we find a qualifying random value.
  while (true) {
    // Pick a random value.
    float r1 = random(1);
    // Assign a probability.
    float probability = r1;
    // Pick a second random value.
    float r2 = random(1);

    //[full] Does it qualify?  If so, we’re done!
    if (r2 < probability) {
      return r1;
    }
    //[end]
  }
}
```

- Perlin noise 
  

can be used to generate various effects with natural qualities, such as clouds, landscapes, and patterned textures like marble

- 1D: wandering
- 2D: cloudy texture

## vectors

vector(x,y) operations
- add
- sub
- multi
- divide
- ...

## forces

Newton’s First Law
> An object at rest stays at rest and an object in motion stays in motion at a constant speed 
> and direction unless acted upon by an unbalanced force.

law 2
> Force equals mass times acceleration.

F=ma 由于m在屏幕中设定为1，那么
```
a = F / m = F / 1 =F
```

Thinking:
> 使用力模拟向上漂浮并从窗户顶部弹起的充满氦气的气球。能否根据Perlin噪声添加随时间变化的风力？

### friction
- static friction
- dynamic friction

```
friction = - μ * N * V^
```
> v∧ Look familiar? It should. This refers to the velocity unit vector

In fact, that’s the part of the formula that says -1 * v∧, or -1 times the velocity unit vector
```js
PVector friction = velocity.get();
friction.normalize();
// Let’s figure out the direction of the friction force
// (a unit vector in the opposite direction of velocity).
friction.mult(-1);
```
the magnitude is μ * N.
- μ, the Greek letter mu (pronounced “mew”), is used here to describe the coefficient of friction.
- N refers to the normal force, the force perpendicular to the object’s motion along a surface

### Air and Fluid Resistance
```
Fd= -(1/2) * ρ * (v^2) * A * Cd * (v unit vector).
```
ρ: liquid density
v: object speed
A: the frontal area of the object that is pushing through the liquid (or gas)
Cd: coefficient of drag

Our simplified drag force formula
```
Fd= (v^2) *  Cd * (v unit vector) * (-1)
```
```js
float c = 0.1;
float speed = v.mag();
// Part 1 of our formula (magnitude): Cd * v2
float dragMagnitude = c * speed * speed;

PVector drag = velocity.get();
// Part 2 of our formula (direction):
// -1 * velocity
drag.mult(-1);
drag.normalize();

// Magnitude and direction together!
drag.mult(dragMagnitude);
```

### Gravitational Attraction
```js
// The vector that points from one object to another
PVector force = PVector.sub(location1,location2);

// The length (magnitude) of that vector is the distance between the two objects.
float distance = force.magnitude();

// Use the formula for gravity to compute the strength of the force.
float m = (G * mass1 * mass2) / (distance * distance);

// Normalize and scale the force vector
// to the appropriate magnitude.
force.normalize();
force.mult(m);
```

## Chapter 3. Oscillation

Angular Motion

```
location = location + velocity
velocity = velocity + acceleration
```

```
angle = angle + angular velocity
angular velocity = angular velocity + angular acceleration
```

arctan vs arctan2

arctan2 已经包含正确的向量方向, heading2D 可以直接获取任何向量的弧度

开始学习建模时，喜欢在主draw() 函数中 实现力的作用，这样容易理解。
但是，当熟悉之后，应该在对象内部封装这些逻辑。 这样，代码会更加语义化和简洁。

生态系统生物运动示例：AttractionArrayWithOscillation

## 粒子系统

经典欧拉积分运动模型

## 物理函数库

box2D

toxiclibs

韦尔莱积分法

- 如果系统涉及物体碰撞，自定义形状的物体，那就用box2D
- 如果粒子系统，吸引或者排斥，有时使用弹簧链接，那就使用toxiclibs

## 自治智能体

到达行为：
- 离目标很远，高速前进，
- 离目标很近，减速前进。
- 到达目标，停下来。

编码策略 ，假设目标是一个给定半径r的圆。
- 在圆之外，最大速率前进
- 在圆内，减速前进。将速度map为5%的距离
- 位于目标位置，速度为0

> 转向力=所需速度 - 当前速度, 生命体才会感知到自己的当前速度，石头这种非生物体就不会知道。

wandering 游走：一种随机性转向，下一帧转向角度依赖于上一帧的转向。这种方式比每一帧随机转向更有趣。

随机游走的实现：参考 exercise 6.4

## 细胞自动机

## 分形
- 康托尔集
- 科赫曲线

递归方式构建分形：树枝是一个线段，线段末尾有两个小树枝。

> process transform2d 了解pushMatrix和popMatrix的实现

- 生成tree
- L 系统生成ABA模式



## 代码的进化论

基因型和表现型



## 神经网络
